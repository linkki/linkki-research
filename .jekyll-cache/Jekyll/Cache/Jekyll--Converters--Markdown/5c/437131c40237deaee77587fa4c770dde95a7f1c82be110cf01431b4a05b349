I"€$<h1 id="v√§istelypeli">V√§istelypeli</h1>

<canvas width="800" height="600" id="kangas"></canvas>

<script>

// Apufunktio et√§isyyden laskemiseen
function et√§isyys(hahmo1, hahmo2) {
	const dx = hahmo1.X - hahmo2.X
	const dy = hahmo1.Y - hahmo2.Y
	return Math.sqrt(dx*dx + dy*dy)
}

// Apufunktio siirt√§miseen
function siirr√§Kohti(hahmo1, hahmo2, nopeus) {
	const dx = hahmo2.X - hahmo1.X
	const dy = hahmo2.Y - hahmo1.Y
	const e = et√§isyys(hahmo2, hahmo1)
	
	hahmo1.X += dx/e*nopeus
	hahmo1.Y += dy/e*nopeus
}

const piirt√§j√§ = kangas.getContext("2d")

// M√§√§ritell√§√§n hahmot
const hiiri = {
	X: 0,
	Y: 0,
}
const pelaaja = {
	X: 100,
	Y: 100,
	pisteet: 0,
}
const viholliset = []

// Pidet√§√§n hiiren koordinaatit ajan tasalla
kangas.onmousemove = event => {
	hiiri.X = event.offsetX
	hiiri.Y = event.offsetY
}

function piirr√§() {
	// Tyhjennet√§√§n ruutu
	piirt√§j√§.clearRect(0, 0, 800, 600)

	// Piirret√§√§n pisteet
	piirt√§j√§.fillStyle = "black"
	piirt√§j√§.fillText("Pisteet: " + pelaaja.pisteet, 10, 20)
	
	// Piirret√§√§n pelaajahahmo
	piirt√§j√§.fillStyle = "blue"
	piirt√§j√§.fillRect(pelaaja.X-50, pelaaja.Y-50, 100, 100)
	
	// K√§yd√§√§n l√§pi vihollishahmot
	for (const vihollinen of viholliset) {
		// Piirret√§√§n vihollishahmo
		piirt√§j√§.fillStyle = "red"
		piirt√§j√§.fillRect(vihollinen.X-50, vihollinen.Y-50, 100, 100)
	}
	
	// Pyydet√§√§n selainta piirt√§m√§√§n samat asiat kohta uudestaan
	requestAnimationFrame(piirr√§)
}

// Pyydet√§√§n selainta piirt√§m√§√§n asiat ensimm√§isen kerran
requestAnimationFrame(piirr√§)

// Liikutetaan hahmoa ja vihollisia (ikuisessa silmukassa)
setInterval(() => {
	siirr√§Kohti(pelaaja, hiiri, 3)
	
	// K√§yd√§√§n l√§pi viholliset
	for (const vihollinen of viholliset) {
		// Liikutetaan vihollista
		siirr√§Kohti(vihollinen, pelaaja, 0.5)
		vihollinen.X -= 2

		// Tarkistetaan osuma pelaajaan
		if (et√§isyys(pelaaja, vihollinen) < 100) {
			pelaaja.pisteet = 0
			pelaaja.X = 100
			pelaaja.Y = 100
			viholliset.splice(0, viholliset.length)
		}

		// Tarkistetaan osuma reunaan ja siirret√§√§n tarvittaessa takaisin alkuun
		if (vihollinen.X < -100) {
			vihollinen.X = 900
		}
	}
}, 10)

// Luodaan uusi vihollinen viiden sekunnin v√§lein ja kasvatetaan samalla pisteit√§
setInterval(() => {
	pelaaja.pisteet += 1
	viholliset.push({
		X: 900,
		Y: Math.random()*600,
	})
}, 5000)
</script>

<h2>Ohjeet</h2>

<h3>Alkuvalmistelut</h3>

<p class="task">Kopioi aloituspohja (kankaan kokoa ja v√§ri√§ voi muuttaa halutessaan:</p>
<script>codeExample(`<!doctype HTML>

<canvas width = 800
        height = 600
        style = background-color:beige;></canvas>

<script>

${closeScript}`, "html");</script>

<p class="task">K√§yt√§mme teht√§v√§ss√§ seuraavia funktioita kahden hahmon et√§isyyden laskemiseen ja hahmon liikuttamiseen. Kopioi ne <code>&lt;script&gt;</code>-t√§gien v√§liin.</p>
<script>codeExample(`// Apufunktio et√§isyyden laskemiseen
function et√§isyys(hahmo1, hahmo2) {
	const dx = hahmo1.X - hahmo2.X
	const dy = hahmo1.Y - hahmo2.Y
	return Math.sqrt(dx*dx + dy*dy)
}

// Apufunktio siirt√§miseen
function siirr√§Kohti(hahmo1, hahmo2, nopeus) {
	const dx = hahmo2.X - hahmo1.X
	const dy = hahmo2.Y - hahmo1.Y
	const e = et√§isyys(hahmo2, hahmo1)
	
	hahmo1.X += dx/e*nopeus
	hahmo1.Y += dy/e*nopeus
}
`, "javascript");</script>

<p class="task">M√§√§rittele piirt√§j√§-muuttuja piirt√§mist√§ varten:</p>
<script>codeExample(`const piirt√§j√§ = kangas.getContext("2d") `, "javascript");</script>

<h3>Hahmojen muuttujat</h3>

<p>Muistutuksena hahmo-olion ja sen sis√§lt√§m√§t muuttujat luodaan n√§in:</p>

<script>codeExample(`const pelaaja = {
	X: 100,
	Y: 100,
	pisteet: 0,
}
`, "javascript");</script>

<p>
	<span class="task">Luo <code>pelaaja</code>, jolla on muuttujat <code>X</code>, <code>Y</code> ja <code>pisteet</code>.</span>
	<span class="task">Lis√§ksi luo <code>hiiri</code>, joilla on vain <code>X</code> ja <code>Y</code>.</span>
	Voit asettaa hahmojen X- ja Y-koordinaatit alussa miten haluat.
</p>

<p>
	Hiiri-hahmon tarkoitus on olla siin√§, miss√§ hiiri on.
	JavaScriptiss√§ emme voi selvitt√§√§ milloin vain, miss√§ hiiri on, vaan saamme tiet√§√§ hiiren sijainnin vain, kun se liikkuu.
	Siirt√§m√§ll√§ hiiri-hahmon kursorin p√§√§lle sen liikkuessa tied√§mme aina, miss√§ hiiri on.
	<span class="task">K√§yt√§ seuraavaa koodia:</span>
</p>

<script>codeExample(`// Pidet√§√§n hiiren koordinaatit ajan tasalla
kangas.onmousemove = event => {
	hiiri.X = event.offsetX
	hiiri.Y = event.offsetY
}
`, "javascript");</script>

<h3>Piirtosilmukka</h3>

<p class="task">Tee <code>piirr√§</code>-funktiosta piirtosilmukka k√§ytt√§en <code>requestAnimationFrame</code>-funktiota:</p>

<script>codeExample(`function piirr√§() {
	// Tyhjennet√§√§n ruutu
	piirt√§j√§.clearRect(0, 0, 800, 600)
	
	/* Piirret√§√§n hahmot t√§ss√§ */
	
	// Pyydet√§√§n selainta piirt√§m√§√§n samat asiat kohta uudestaan
	requestAnimationFrame(piirr√§)
}

// Pyydet√§√§n selainta piirt√§m√§√§n asiat ensimm√§isen kerran
requestAnimationFrame(piirr√§)
`, "javascript");</script>

<p class="task">
	Piirr√§ funktion sis√§ll√§ pelaaja.
	Pelaajan koordinaatit ovat <code>pelaaja.X</code> ja <code>pelaaja.Y</code>.
	Voit piirt√§√§ joko neli√∂n <code>fillRect</code>-komennolla tai kuvan <code>drawImage</code>-komennolla.
</p>

<p>
	Hiiren kohdalle ei tarvitse piirt√§√§ mit√§√§n, n√§kyyh√§n siin√§ jo k√§ytt√∂j√§rjestelm√§n oma kursori, mutta siihen voi halutessaan piirt√§√§ oman kuvan.
</p>

<p class="task">
	Piirr√§ my√∂s teksti <code>"Pisteet " + pelaaja.pisteet</code> n√§kym√§n yl√§reunaan. 
</p>

<p>
	Kokeile nyt, toimiiko pelaajan piirt√§minen. Pisteiden kohdalla pit√§isi lukea tietysti 0.
</p>

<h3>Pelaajan liikuttaminen</h3>

<p class="task">Tee <code>setInterval</code>-silmukka hahmojen liikuttamista varten:</p>

<script>codeExample(`setInterval(() => {
	
	/* T√§h√§n tulee liikuttamisen koodi */
	
})
`, "javascript");</script>

<p class="task">
	Lis√§√§ komento hahmon liikuttamista varten.
	Hahmoja liikutetaan alussa luodulla <code>siirr√§Kohti</code>-funktiolla.
	Aluksi meid√§n tarvitsee vain siirt√§√§ pelaajaa kohti hiirt√§: <code>siirr√§Kohti(pelaaja, hiiri, 1)</code>.
	Lopun <code>1</code> kertoo, mill√§ nopeudella pelaaja liikkuu, ja voit muuttaa sit√§ halutessasi.
	Kokeile eri arvoja v√§lill√§ 1‚Äì5.
</p>

<p>
	Kokeile t√§ss√§ vaiheessa, toimiiko peli ja hahmon liikuttaminen.
</p>

<h3>Vihollislista</h3>

<p>
	Tallennamme viholliset listaan, johon voimme lis√§t√§ aina tarvittaessa lis√§√§ vihollisia.
	<span class="task">Tee uusi muuttuja vihollislistaa varten pelaaja- ja hiirihahmojen j√§lkeen:</span>
</p>

<script>codeExample(`const viholliset = [] `, "javascript");</script>

<p>
	Lista on alussa tyhj√§.
	Siihen voi lis√§t√§ uuden vihollisen <code>.push()</code>-komennolla:
</p>

<script>codeExample(`viholliset.push({
	X: 400,
	Y: Math.random()*600,
}) `, "javascript");</script>

<p>Voit kokeilun vuoksi lis√§t√§ yhden vihollisen listaan heti listan luomisen j√§lkeen.</p>

<h3>Vihollisten piirt√§minen</h3>

<p class="task">
	Piirr√§ viholliset piirtofunktiossa.
	K√§yt√§ <code>for of</code> -silmukkaa k√§yd√§ksesi l√§pi kaikki viholliset.
	K√§yt√§ silmukan sis√§ll√§ samanlaista komentoa kuin pelaajankin piirt√§miseen (eri v√§rill√§/kuvalla).
	Silmukan sis√§ll√§ vihollisen X ja Y ovat <code>vihu.X</code> ja <code>vihu.Y</code>.
</p>

<script>codeExample(`for (const vihu of viholliset) {
	
} `, "javascript");</script>

<h3>Vihollisten liikuttaminen</h3>

<p class="task">
	Tee p√§ivitysfunktion (miss√§ pelaajaa liikutetaan) sis√§lle <code>for of</code> -silmukka, jossa k√§yd√§√§n l√§pi kaikki viholliset.
	Voit siirt√§√§ vihollista pelaajaa kohti samalla tavalla kuin pelaajaa hiirt√§ kohti, eli <code>siirr√§Kohti</code>-funktiolla.
	Pelist√§ tulee kiinnostavampi, jos viholliset eiv√§t vain jahtaa pelaajaa, vaan my√∂s liikkuvat vasemmalle samalla kuin esimerkiss√§.
	T√§m√§n saa aikaan komennolla <code>vihu.X -= 2</code>.
	Kokeile taas eri nopeuksia sek√§ pelaajaa p√§in liikuttaessa ett√§ vasemmalle liikuttaessa.
</p>

<p>
	Jos viholliset liikkuvat vasemmalle, ne t√∂rm√§√§v√§t lopulta sein√§√§n ja ne on siirrett√§v√§ takaisin oikeaan reunaan.
	T√§m√§n voi tehd√§ seuraavanlaisella ehtolauseella.
	<span class="task">Lis√§√§ se <code>for of</code> -silmukan sis√§lle.</span>
</p>

<script>codeExample(`if (vihu.X < -100) {
	vihu.X = 900
} `, "javascript");</script>

<p class="task">
	Tarkista <code>for of</code> -silmukan sis√§ll√§ my√∂s, t√∂rm√§√§k√∂ pelaaja viholliseen.
	T√§h√§n voi k√§ytt√§√§ ker√§ilypelist√§ tuttua ehtoa:
</p>

<script>codeExample(`if (et√§isyys(pelaaja, vihu) < 100) {

}
`, "javascript");</script>

<p>
	Tee ehtolauseen sis√§ll√§ mit√§ haluat.
	Voit esimerkiksi asettaa pisteet nollaan ja poistaa viholliset pelist√§ komennolla <code>viholliset.splice(0, viholliset.length)</code>.
</p>

<h3>Uusien vihollisten luominen</h3>

<p class="task">
	Luo uusi <code>setInterval</code>-silmukka uusien vihollisten luomista varten (aseta silmukan ajaksi esim. 5 000 ms).
	K√§yt√§ sen sis√§ll√§ aiemmin mainittua komentoa, jolla voi lis√§t√§ vihollisen listaan.
	Vihollisen X:ksi kannattaa asettaa <code>900</code>, joka on juuri kankaan ulkopuolella, jotta vihollinen ei ilmesty rumasti keskelle peli√§.
</p>

<p class="task">
	Kasvata luomasi <code>setInterval</code>-silmukan sis√§ll√§ pelaajan pisteit√§.
	Pisteiden m√§√§r√§ on siis sama kuin vihollisten m√§√§r√§ kartalla.
</p>

:ET