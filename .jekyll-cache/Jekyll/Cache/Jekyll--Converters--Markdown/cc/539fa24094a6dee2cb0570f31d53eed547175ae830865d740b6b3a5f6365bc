I"„'<h1>Ker√§ilypeli</h1>

<canvas width="800" height="600" id="kangas"></canvas>

<script>

// Apufunktio et√§isyyden laskemiseen
function et√§isyys(hahmo1, hahmo2) {
	const dx = hahmo1.X - hahmo2.X
	const dy = hahmo1.Y - hahmo2.Y
	return Math.sqrt(dx*dx + dy*dy)
}

// Apufunktio siirt√§miseen
function siirr√§Kohti(hahmo1, hahmo2, nopeus) {
	const dx = hahmo2.X - hahmo1.X
	const dy = hahmo2.Y - hahmo1.Y
	const e = et√§isyys(hahmo2, hahmo1)
	
	hahmo1.X += dx/e*nopeus
	hahmo1.Y += dy/e*nopeus
}

const piirt√§j√§ = kangas.getContext("2d")

// laitetaan kuvan silotus pois p√§√§lt√§
// koska hahmojen kuvat ovat pixelarttia
piirt√§j√§.imageSmoothingEnabled = false;
piirt√§j√§.mozImageSmoothingEnabled = false;
piirt√§j√§.webkitImageSmoothingEnabled = false;
piirt√§j√§.msImageSmoothingEnabled = false;

// t√§ytyy kirjoittaa ilman v√§lily√∂ntej√§ '=' ymp√§rill√§: const imgs_src="polku/kuviin"
const imgs_src="https://www.mv.helsinki.fi/home/lawkaita/more/linkki/img"

const ankkakuva = new Image()
ankkakuva.src = imgs_src + "/pixelwalker.webp"

const kettukuva = new Image()
kettukuva.src = imgs_src + "/pixelfox-save3.webp"

const kalakuva = new Image()
kalakuva.src = imgs_src + "/kala.webp"

// M√§√§ritell√§√§n hahmot
const hiiri = {
	X: 0,
	Y: 0,
}
const pelaaja = {
	X: 100,
	Y: 100,
	pisteet: 0,
        kuva: ankkakuva,
}
const vihollinen = {
	X: 400,
	Y: 400,
        kuva: kettukuva,
}
const aarre = {
	X: Math.random()*800,
	Y: Math.random()*600,
        kuva: kalakuva,
}

// Pidet√§√§n hiiren koordinaatit ajan tasalla
kangas.onmousemove = event => {
	hiiri.X = event.offsetX
	hiiri.Y = event.offsetY
}

function piirr√§() {
	// Tyhjennet√§√§n ruutu
	piirt√§j√§.clearRect(0, 0, 800, 600)
	
	piirt√§j√§.fillStyle = "black"
	piirt√§j√§.fillText("Pisteet: " + pelaaja.pisteet, 10, 20)
	
	// Piirret√§√§n pelaajahahmo
        // spriten koko on 64 x 64 pikseli√§
        piirt√§j√§.drawImage(pelaaja.kuva, pelaaja.X-32, pelaaja.Y-32)
	
	// Piirret√§√§n vihollishahmo
        // spriten koko on 64 x 64 pikseli√§
        piirt√§j√§.drawImage(vihollinen.kuva, vihollinen.X-32, vihollinen.Y-32)
	
	// Piirret√§√§n aarrehahmo
        // spriten koko on 32 x 32 pikseli√§
        piirt√§j√§.drawImage(aarre.kuva, aarre.X-16, aarre.Y-16)
	
	// Pyydet√§√§n selainta piirt√§m√§√§n samat asiat kohta uudestaan
	requestAnimationFrame(piirr√§)
}

// Pyydet√§√§n selainta piirt√§m√§√§n asiat ensimm√§isen kerran
requestAnimationFrame(piirr√§)

// Liikutetaan hahmoa ja vihollista (ikuisessa silmukassa)
setInterval(() => {
	siirr√§Kohti(pelaaja, hiiri, 1)
	siirr√§Kohti(vihollinen, pelaaja, 0.5)
	
	// Tarkistetaan osuma aarteeseen
        // (64 + 16)/2 = 40 tuntuu hyv√§lt√§ et√§isyydelt√§ kokeilemalla
	if (et√§isyys(pelaaja, aarre) < 40) {
		pelaaja.pisteet += 1
		while (et√§isyys(pelaaja, aarre) < 40) {
			aarre.X = Math.random()*800
			aarre.Y = Math.random()*600
		}
	}
	
	// Tarkistetaan osuma viholliseen
        // (64 + 32)/2 = 48 tuntuu hyv√§lt√§ et√§isyydelt√§ kokeilemalla
	if (et√§isyys(pelaaja, vihollinen) < 48) {
		pelaaja.pisteet = 0
		pelaaja.X = 100
		pelaaja.Y = 100
		vihollinen.X = 400
		vihollinen.Y = 400
	}
}, 10)
</script>

<h2>Ohjeet</h2>

<h3>Alkuvalmistelut</h3>

<p class="task">Kopioi aloituspohja (kankaan kokoa ja v√§ri√§ voi muuttaa halutessaan:</p>
<script>codeExample(`<!doctype HTML>

<canvas width = 800
        height = 600
        style = background-color:beige;></canvas>

<script>

${closeScript}`, "html");</script>

<p class="task">K√§yt√§mme teht√§v√§ss√§ seuraavia funktioita kahden hahmon et√§isyyden laskemiseen ja hahmon liikuttamiseen. Kopioi ne <code>&lt;script&gt;</code>-t√§gien v√§liin.</p>
<script>codeExample(`// Apufunktio et√§isyyden laskemiseen
function et√§isyys(hahmo1, hahmo2) {
	const dx = hahmo1.X - hahmo2.X
	const dy = hahmo1.Y - hahmo2.Y
	return Math.sqrt(dx*dx + dy*dy)
}

// Apufunktio siirt√§miseen
function siirr√§Kohti(hahmo1, hahmo2, nopeus) {
	const dx = hahmo2.X - hahmo1.X
	const dy = hahmo2.Y - hahmo1.Y
	const e = et√§isyys(hahmo2, hahmo1)
	
	hahmo1.X += dx/e*nopeus
	hahmo1.Y += dy/e*nopeus
}
`, "javascript");</script>

<p class="task">M√§√§rittele piirt√§j√§-muuttuja piirt√§mist√§ varten:</p>
<script>codeExample(`const piirt√§j√§ = kangas.getContext("2d") `, "javascript");</script>

<h3>Hahmojen muuttujat</h3>

<p>Muistutuksena hahmo-olion ja sen sis√§lt√§m√§t muuttujat luodaan n√§in:</p>

<script>codeExample(`const pelaaja = {
	X: 100,
	Y: 100,
	pisteet: 0,
}
`, "javascript");</script>

<p>
	<span class="task">Luo <code>pelaaja</code>, jolla on muuttujat <code>X</code>, <code>Y</code> ja <code>pisteet</code>.</span>
	<span class="task">Lis√§ksi luo <code>hiiri</code>, joilla on vain <code>X</code> ja <code>Y</code>.</span>
	Voit asettaa hahmojen X- ja Y-koordinaatit alussa miten haluat.
</p>

<p>
	Hiiri-hahmon tarkoitus on olla siin√§, miss√§ hiiri on.
	JavaScriptiss√§ emme voi selvitt√§√§ milloin vain, miss√§ hiiri on, vaan saamme tiet√§√§ hiiren sijainnin vain, kun se liikkuu.
	Siirt√§m√§ll√§ hiiri-hahmon kursorin p√§√§lle sen liikkuessa tied√§mme aina, miss√§ hiiri on.
	<span class="task">K√§yt√§ seuraavaa koodia:</span>
</p>

<script>codeExample(`// Pidet√§√§n hiiren koordinaatit ajan tasalla
kangas.onmousemove = event => {
	hiiri.X = event.offsetX
	hiiri.Y = event.offsetY
}
`, "javascript");</script>

<h3>Piirtosilmukka</h3>

<p class="task">Tee <code>piirr√§</code>-funktiosta piirtosilmukka k√§ytt√§en <code>requestAnimationFrame</code>-funktiota:</p>

<script>codeExample(`function piirr√§() {
	// Tyhjennet√§√§n ruutu
	piirt√§j√§.clearRect(0, 0, 800, 600)
	
	/* Piirret√§√§n hahmot t√§ss√§ */
	
	// Pyydet√§√§n selainta piirt√§m√§√§n samat asiat kohta uudestaan
	requestAnimationFrame(piirr√§)
}

// Pyydet√§√§n selainta piirt√§m√§√§n asiat ensimm√§isen kerran
requestAnimationFrame(piirr√§)
`, "javascript");</script>

<p class="task">
	Piirr√§ funktion sis√§ll√§ pelaaja.
	Pelaajan koordinaatit ovat <code>pelaaja.X</code> ja <code>pelaaja.Y</code>.
	Voit piirt√§√§ joko neli√∂n <code>fillRect</code>-komennolla tai kuvan <code>drawImage</code>-komennolla.
</p>

<p>
	Hiiren kohdalle ei tarvitse piirt√§√§ mit√§√§n, n√§kyyh√§n siin√§ jo k√§ytt√∂j√§rjestelm√§n oma kursori, mutta siihen voi halutessaan piirt√§√§ oman kuvan.
</p>

<p class="task">
	Piirr√§ my√∂s teksti <code>"Pisteet " + pelaaja.pisteet</code> n√§kym√§n yl√§reunaan. 
</p>

<p>
	Kokeile nyt, toimiiko pelaajan piirt√§minen. Pisteiden kohdalla pit√§isi lukea tietysti 0.
</p>

<h3>Pelaajan liikuttaminen</h3>

<p class="task">Tee <code>setInterval</code>-silmukka hahmojen liikuttamista varten:</p>

<script>codeExample(`setInterval(() => {
	
	/* T√§h√§n tulee liikuttamisen koodi */
	
})
`, "javascript");</script>

<p class="task">
	Lis√§√§ komento hahmon liikuttamista varten.
	Hahmoja liikutetaan alussa luodulla <code>siirr√§Kohti</code>-funktiolla.
	Aluksi meid√§n tarvitsee vain siirt√§√§ pelaajaa kohti hiirt√§: <code>siirr√§Kohti(pelaaja, hiiri, 1)</code>.
	Lopun <code>1</code> kertoo, mill√§ nopeudella pelaaja liikkuu, ja voit muuttaa sit√§ halutessasi.
</p>

<p>
	Kokeile t√§ss√§ vaiheessa, toimiiko peli ja hahmon liikuttaminen.
</p>

<h3>Aarre</h3>

<p class="task">
	Luo uusi hahmo-olio <code>aarre</code> samaan tapaan kuin <code>pelaaja</code> ja <code>hiiri</code> on luotu.
	Aarteella on vain <code>X</code> ja <code>Y</code>.
	Voit asettaa koordinaatit aluksi miten haluat.
</p>

<h3>Aarteeseen koskettaminen</h3>

<p>
	K√§yt√§mme alussa luotua <code>et√§isyys</code>-funktiota tarkistaaksemme, miten l√§hell√§ olemme aarretta.
	<span class="task">Tee <code>if</code>-lause, jonka ehto on <code>et√§isyys(pelaaja, aarre) &lt; 100</code>:</span>
</p>

<script>codeExample(`if (et√§isyys(pelaaja, aarre) < 100) {

}
`, "javascript");</script>

<p class="task">
	<code>if</code>-lauseen sis√§ll√§ kasvata pelaajan pisteit√§ (<code>pelaaja.pisteet</code>) yhdell√§.
</p>

<p class="task">
	Haluamme arpoa aarteelle uuden sijainnin osuman j√§lkeen.
	K√§yt√§mme siihen <code>Math.random()</code>-funktiota:
</p>

<script>codeExample(`aarre.X = Math.random()*800
aarre.Y = Math.random()*600`, "javascript");</script>

<p>
	Kokeile nyt peli√§.
	Saatat huomata, ett√§ pistem√§√§r√§ kasvaa joskus enemm√§ll√§ kuin yhdell√§.
	T√§m√§ johtuu siit√§, ett√§ joskus aarteen uusi sijainti koskettaa my√∂s pelaajaa, ja t√§st√§ tulee ylim√§√§r√§inen piste.
	Est√§√§ksemme t√§m√§n meid√§n on varmistettava, ett√§ uusi paikka ei kosketa pelaajaa.
	T√§m√§ on helpointa tehd√§ <code>while</code>-silmukalla, joka arpoo sijainnin uudestaan, kunnes et√§isyys on tarpeeksi suuri.
	<span class="task">Lis√§√§ silmukka sijainnin arpomisen ymp√§rille:</span>
</p>

<script>codeExample(`while (et√§isyys(pelaaja, aarre) < 100) {

}
`, "javascript");</script>

<p>Kokeile taas, toimiiko peli.</p>

<h3>Vihollinen</h3>

<p>
	Haluamme peliin vihollisen, joka jahtaa pelaajaa.
	<span class="task">T√§t√§ varten tee uusi hahmo-olio nimelt√§ <code>vihollinen</code>, jolla on vain <code>X</code> ja <code>Y</code>.</span>
	Niiden alkuarvot kannattaa asettaa mahdollisimmat kauas pelaajan alkukoordinaateista, jotta peli ei ole liian vaikea.
</p>

<p>
	<span class="task">Lis√§√§ <code>setInterval</code>-silmukan sis√§√§n komento vihollisen liikuttamiseksi hahmoa p√§in: <code>siirr√§Kohti(vihollinen, pelaaja, 0.5)</code>.</span>
	Nopeuden kannattaa olla pienempi kuin pelaajan nopeus, jotta viholliselta voi p√§√§st√§ karkuun.
	Kokeile peli√§ ja eri nopeuksia ja koeta valita hyv√§ nopeus.
</p>

<p>
	Lopuksi tarkistetaan, osuuko vihollinen pelaajaan.
	<span class="task">Tehd√§√§n t√§t√§ varten samanlainen <code>if</code>-lause kuin aarteen osuman tarkistukseen, mutta tarkastetaankin pelaajan ja vihollisen v√§linen et√§isyys.</span>
	Ehtolauseen sis√§ll√§ resetoi peli:
</p>

<ol>
<li><span class="task">Aseta pelaajan X ja Y takaisin alkupisteeseen.</span>
<li><span class="task">Aseta vihollisen X ja Y takaisin alkupisteseen.</span>
<li><span class="task">Aseta pelaajan pisteet nollaan.</span>
&lt;/ol&gt;

<p>
	Voit asettaa pisteet my√∂s johonkin muuhun arvoon.
	Ehk√§ tilanne ei olekaan t√§ysi h√§vi√∂, vaan pisteit√§ vain v√§hennet√§√§n jollain m√§√§r√§ll√§.
	Voit muuttaa pelilogiikan mieleiseksesi.
</p>
</li></li></li></ol>
:ET