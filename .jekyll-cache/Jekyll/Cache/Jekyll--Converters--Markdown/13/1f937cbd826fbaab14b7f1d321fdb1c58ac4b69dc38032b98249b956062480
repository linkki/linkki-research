I"‹8<p><b>Funktio</b> eli aliohjelma ohjelmoijien k√§ytt√§m√§ sana kasalle koodia, joka voidaan suorittaa tarvittaessa. Funktion koodia ei siis suoriteta heti, vaan vasta joskus my√∂hemmin. Olemme jo n√§hneet funktioita osassa 3, jossa loimme tapahtumak√§sittelij√∂it√§. Ne ovat er√§s esimerkki funktiosta.</p>

<p>Funktioita k√§ytet√§√§n JavaScriptiss√§ monilla eri tavoilla ja ne voivat n√§ytt√§√§ erilaisilta. Yleisesti ottaen funktiot voi jakaa kahteen luokkaan: <b>nuolifunktoihin</b>, jotka tunnistaa nuolesta <code>=&gt;</code>, ja <b>avainsanafunktioihin</b>, jotka tunnistaa avainsanasta <code>function</code>.</p>

<p>Alla on esimerkkej√§ erilaisista funktiosta, joihin tutustumme t√§ss√§ luvussa.</p>

<script>codeExample(
`// Tapahtumak√§sittelij√§:

teksti.onclick = () => {
    alert("Hei siell√§!")
}

// Ajastin:

setTimeout(() => {
    alert("Yll√§tys!")
}, 5000)

// Toistettu funktio:

setInterval(() => {
    alert("Hei taas!")
}, 5000)

// Nimetty funktio:

function liikutaYl√∂s() {
    hahmo.y -= 1
}

// Piirtofunktio:

function piirr√§() {
    piirt√§j√§.clearRect(0, 0, 300, 150)    
    piirt√§j√§.fillRect(hahmo.x, hahmo.y, 10, 10)

    requestAnimationFrame(piirr√§)
}
requestAnimationFrame(piirr√§)
`,"javascript");</script>

<div class="codebox question">
	<h3>Kysymys 5.1</h3>
	<p>
		Mitk√§ yll√§ olevista funktioista ovat nuolifunktiota ja mitk√§ avainsanafunktioita?
	</p>
</div>

<h2 id="tapahtum√§k√§sittelij√§t--kertaus">Tapahtum√§k√§sittelij√§t ‚Äì kertaus</h2>

<p>Tutustuimme tapahtumak√§sittelij√∂ihin jo luvussa 3. Ne ovat funktioita, jotka suoritetaan kun jotain tietty√§ tapahtuu. Esimerkiksi napin painaminen ja hiiren liikuttaminen ovat tapahtumia.</p>

<div class="codebox example">
	<h3>Esimerkki 5.2</h3>
	<p>
	Tapahtumak√§sittelij√§ n√§ytt√§√§ ilmoituksen, kun teksti√§ klikataan.
	</p>
	<script>
		addEditor(
`<!doctype HTML>
<p id = teksti>Klikkaa t√§st√§!</p>
<script>
	teksti.onclick = e => {
		alert("Hei siell√§!")
	}
${closeScript}`
		);
	</script>
</div>

<p>TODO: listaa t√§ss√§ eri tapahtumak√§sittelij√∂it√§</p>

<p>TODO: Teht√§v√§, jossa napin painaminen aiheuttaa jotain</p>

<div class="codebox task">
	<h3>Teht√§v√§</h3>
	<p>Lis√§√§ painikkeelle kuuntelija. 
		Kun painiketta klikataan, niin tulosta <code>alert()</code>&gt; komennolla "Klikkasit painiketta."</p>
	<script>
	addEditor(
`<!doctype HTML>
<button id = painike>
Miss√§ ankat uivat?
</button>

<script>
${closeScript}`
	);</script>
</div>

<div class="codebox task">
	<h3>Teht√§v√§</h3>
	<p>T√§ydenn√§ ohjelmaa niin, ett√§ kun k√§ytt√§j√§ painaa n√§pp√§int√§ "a", 
		niin tulostuu <code>alert()</code> komennolla "Ankka aivasti avaruudessa.".
	</p>
	<script>
	addEditor(
`<!doctype HTML>
<script>
	document.onkeydown = event => {
		if(event.key == "a"){

		}
}
${closeScript}`
	);</script>
</div>

<div class="codebox task">
	<h3>Teht√§v√§</h3>
	<p>
		T√§ydenn√§ ohjelmaa niin, ett√§ kun k√§ytt√§j√§ klikkaa painiketta, niin neli√∂n v√§ri vaihtuu punaiseksi. 
		Neli√∂n v√§ri vaihtuu, kun piirr√§t sen p√§√§lle uuden neli√∂n, joka on eriv√§rinen.
	</p>
	<script>
	addEditor(
`<!doctype HTML>
<canvas id=kangas></canvas>
<br>
<button>
	Vaihda v√§ri√§.	
</button>

<script>
	const piirt√§j√§ = kangas.getContext("2d")
	piirt√§j√§.fillRect(10, 10, 50, 50)
	
${closeScript}`
	);</script>
</div>

<h2 id="ajastimet">Ajastimet</h2>

<p>Seuraava funktiotyyppi johon tutustumme on <b>ajastetut funktiot</b>. Ajastettu funktio suoritetaan, kun tietty m√§√§r√§ aikaa on kulunut. JavaScriptiss√§ ajastetun funktion luomiseen k√§ytet√§√§n <code>setTimeout</code>-komentoa.</p>

<p><code>setTimeout</code>-komento n√§ytt√§√§ seuraavanlaiselta:</p>

<script>codeExample(
`setTimeout(() => {
    
}, 5000)
`,"javascript");</script>

<p>Aika, jonka kuluttua funktio suoritetaan, on aivan komennon lopussa. Aika ilmoitetaan <b>millisekunteina</b> eli sekunnin tuhannesosina. 1 000 millisekuntia on yksi sekunti, 5 000 on viisi sekuntia ja niin edelleen. Yksi minuutti on 60 000 millisekuntia.</p>

<div class="codebox example">
	<h3>Esimerkki 5.3</h3>
	<p>
	Ajastettu funktio, joka suoritetaan 5 sekunnin kuluttua.
	</p>
<script>
		addEditor(
`<!doctype HTML>
<script>
	setTimeout(() => {
		alert("Yll√§tys!")
	}, 5000)
${closeScript}`);
</script>
</div>

<div class="codebox task">
	<h3>Teht√§v√§</h3>
	<p>Tee ohjelma, joka vaihtaa neli√∂n v√§ri√§ kahden sekunnin kuluttua keltaiseksi. 
		Muista, ett√§ neli√∂n v√§ri vaihtuu, kun sen p√§√§lle piirret√§√§n uusi eri v√§rinen neli√∂.
	</p>
	<script>
	addEditor(
`<!doctype HTML>
<canvas id=kangas>
<canvas>
<script>
	const piirt√§j√§ = kangas.getContext("2d")
	piirt√§j√§.fillRect(10, 10, 50, 50)
${closeScript}`
	);</script>
</div>

<p>Ajastetun funktion voi laittaa tapahtumak√§sittelij√§n sis√§lle, jolloin se suoritetaan tietyn ajan kuluttua tapahtumasta:</p>

<div class="codebox example">
	<h3>Esimerkki 5.4</h3>
	<p>
	Ajastettu funktio tapahtumak√§sittelij√§n sis√§ll√§. Mit√§ tapahtuu, jos klikkaat teksti√§ uudestaan ennen viestin ilmestymist√§?
	</p>
	<script>
		addEditor(
`<!doctype HTML>
<p id = teksti>Klikkaa t√§st√§!</p>
<script>
	teksti.onclick = e => {
		setTimeout(() => {
			alert("Hei taas!")
		}, 5000)
	}
${closeScript}`
		);
	</script>
</div>

<p>TODO: Teht√§v√§, jossa teksti√§ voi klikata vasta tietyn ajan j√§lkeen</p>

<p>TODO: Teht√§v√§, jossa on kaksi sis√§kk√§ist√§ setTimeoutia</p>

<h2 id="toistetut-funktiot">Toistetut funktiot</h2>

<p><b>Toistettu funktio</b> muistuttaa muuten ajastettua funktiota, mutta suoritetaan yhden kerran sijasta loputtomasti tietyll√§ tahdilla.
Esimerkiksi 1 000 ms:n v√§lein toistettava funktio suoritetaan aina sekunnin v√§lein:</p>

<script>codeExample(
`setInterval(() => {
	
}, 1000)
`,"javascript");</script>

<div class="codebox example">
	<h3>Esimerkki 5.5</h3>
	<p>
	Toistettu funktio, joka lis√§√§ rivej√§ tekstiin. K√§yt√§mme komentoa <code>.textContent +=</code>, joka lis√§√§ loppuun uutta teksti√§.
	</p>
	<script>
		addEditor(
`<!doctype HTML>
<p id = teksti>Ensimm√§inen lause on t√§ss√§.</p>
<script>
	setInterval(() => {
		teksti.textContent += " T√§ss√§ on uusi lause!"
	}, 2000)
${closeScript}`
		);
	</script>
</div>

<p>Toistetut funktiot ovat hyvin t√§rkeit√§ peleiss√§, joissa usein halutaan, ett√§ asioita tapahtuu uudestaan ja uudestaan tietyin v√§liajoin.
T√§m√§n luvun lopussa k√§sittelemme <i>p√§ivityssilmukoita</i>, jotka ovat t√§llaisia peliss√§ k√§ytett√§vi√§ toistettuja funktioita.</p>

<h2 id="nimetyt-funktiot">Nimetyt funktiot</h2>

<p>Olemme nyt k√§sitelleet funktioita, jotka suoritetaan automaattisesti joko silloin, kun jotain tapahtuu, tai tietyn ajan p√§√§st√§. Monesti on kuitenkin hy√∂dyllist√§ tehd√§ funktio, joka pit√§√§ suorittaa manuaalisesti komennolla. Koska t√§llaisilla funktioilla pit√§√§ olla nimi, kutsumme n√§it√§ funktioita <b>nimetyiksi funktioiksi</b>. Alla on esimerkki nimetyst√§ funktiosta.</p>

<div class="codebox example">
	<h3>Esimerkki 5.6</h3>
	<p>
	Nimetty funktio, joka suoritetaan heti, 5 s kuluttua ja kun teksti√§ painetaan.
	</p>
	<script>
		addEditor(
`<!doctype HTML>
<p id = teksti>Klikkaa t√§st√§!</p>
<script>
	function yll√§tys() {
		alert("Yll√§tys!")
	}

	yll√§tys()

	setTimeout(() => {
		yll√§tys()
	}, 5000)

	teksti.onclick = () => {
		yll√§tys()
	}
${closeScript}`
		);
	</script>
</div>

<p>Nimetty funktio suoritetaan kirjoittamalla funktion nimi ja sulut. Toisin kuin muuntyyppisi√§ funktioita, sit√§ ei suoritetaan miss√§√§n automaattisesti.</p>

<p>T√§rkein syy miksi nimettyj√§ funktioita k√§ytet√§√§n on koodin kopioimisen v√§ltt√§minen. Jos haluamme tehd√§ saman asian useassa eri kohdassa, on k√§tev√§√§, ett√§ asian koodi on funktion sis√§ll√§, ja eri kohdissa mainitaan vain funktion nimi.</p>

<p>TODO: Teht√§v√§, mik√§?</p>

<h3 id="parametrit">Parametrit</h3>

<p>Nimetylle funktiolle voi antaa <b>parametreja</b>. Parametrit ovat muuttujia, joiden avulla funktiolle voi kertoa asioita. Alla on esimerkki, jossa parametrin avulla voimme n√§ytt√§√§ ylim√§√§r√§isen viestin k√§ytt√§j√§lle.</p>

<div class="codebox example">
	<h3>Esimerkki 5.7</h3>
	<p>
	Nimetty funktio, joka suoritetaan heti, 5 s kuluttua ja kun teksti√§ painetaan.
	</p>
	<script>
		addEditor(
`<!doctype HTML>
<p id = teksti>Klikkaa t√§st√§!</p>
<script>
	function yll√§tys(viesti) {
		alert("Yll√§tys " + viesti + "!")
	}

	yll√§tys("ekan kerran")

	setTimeout(() => {
		yll√§tys("taas")
	}, 5000)

	teksti.onclick = () => {
		yll√§tys("klikatessa")
	}
${closeScript}`
		);
	</script>
</div>

<p>TODO: Teht√§v√§, mik√§?</p>

<h3 id="paluuarvo">Paluuarvo</h3>

<p>TODO</p>

<h2 id="oliot-piirtosilmukka-ja-p√§ivityssilmukka">Oliot, piirtosilmukka ja p√§ivityssilmukka</h2>

<p>Nyt tutustumme funktioiden k√§ytt√§miseen pelien teossa.
Useimmissa peleiss√§ on kaksi t√§rke√§√§ funktiota: <b>piirtosilmukka</b> ja <b>p√§ivityssilmukka</b>.
N√§m√§ molemmat ovat ikuisia silmukoita:
piirtosilmukka piirt√§√§ ikuisesti uudestaan n√§yt√∂ll√§ n√§kyv√§t asiat ja
p√§ivityssilmukka p√§ivitt√§√§ tietokoneen muistia.
Ne ovat hieman erilaisia, koska ne suoritetaan v√§h√§n eri aikoihin.</p>

<h3 id="oliot">Oliot</h3>

<p>Ennen kuin voimme tutustua silmukoihin, tutustutaan siihen miten tietokoneen muisti toimii
(muuten emme osaisi p√§ivitt√§√§ muistia p√§ivityssilmukassa).
JavaScriptiss√§ muisti koostuu <b>olioista</b>.
Kaikki arvot ovat olioita: luvut, merkkijonot, jopa funktiot.
Yleens√§ sanalla olio kuitenkin viitataan <b>avain-arvopareja</b> sis√§lt√§viin olioihin.
N√§it√§ k√§ytet√§√§n esimerkiksi pelihahmojen kuvaamiseen.
Alla on esimerkki.</p>

<script>codeExample(
`const hahmo = {
	X: 200,
	Y: 100,
	v√§ri: "green",
} `,"javascript");</script>

<p>Yll√§ luomme muuttujan <code>hahmo</code>, joka on nimi oliolle, jonka luomme. Itse oliota merkit√§√§n aaltosuluilla (<code>{</code> ja <code>}</code>). Sulkujen v√§liss√§ on avain-arvopareja, joista jokaisessa on aluksi <b>avain</b> (X, Y, v√§ri) ja sitten arvo (200, 100, ‚Äúgreen‚Äù). On t√§rke√§√§ muistaa kaksoispisteet ja pilkut oikeissa kohdissa.</p>

<p>Olio on siis tietopaketti, johon on tallennettu useita eri tietoja.
Voimme k√§ytt√§√§ n√§it√§ tietoja <b>pisteoperaattorilla</b>, joka vastaa suomen kielen genetiivi√§.
Esimerkiksi jos haluamme puhua hahmon v√§rist√§, sanomme <code>hahmo.v√§ri</code>.</p>

<div class="codebox example">
	<h3>Esimerkki 5.8</h3>
	<p>
	Hahmon v√§rin n√§ytt√§minen k√§ytt√§j√§lle.
	</p>
	<script>
		addEditor(
`<!doctype HTML>
<script>
	const hahmo = {
		X: 20,
		Y: 10,
		v√§ri: "green",
	}

	alert("Hahmon v√§ri on: " + hahmo.v√§ri)
${closeScript}`
		);
	</script>
</div>

<p>Oliota voi muokata. T√§ll√∂in k√§yt√§mme sek√§ pisteoperaattoria ett√§ yht√§suuruusoperaattoria.
Alla on esimerkki, jossa asetamme hahmon v√§riksi punaisen.</p>

<script>codeExample(
`hahmo.v√§ri = "red"`,"javascript");</script>

<p>Huomaa, ett√§ oliota luotaessa avaimen ja arvon v√§liss√§ on kaksoispiste.
Olemassa olevaa oliota muokatessa avaimen ja arvon v√§liss√§ on yht√§suuruusmerkki.</p>

<p>TODO: Teht√§v√§, jossa luodaan hahmo-olio ja piirret√§√§n se kankaalle. Toinen, jossa muokataan hahmo-oliota ja piirret√§√§n se kankaalle</p>

<h3 id="piirtosilmukka">Piirtosilmukka</h3>

<p>Piirtosilmukka on funktio, joka suoritetaan aina, kun selain haluaa piirt√§√§ n√§yt√∂ll√§ n√§kyv√§t asiat uudestaan.
Sit√§ k√§ytet√§√§n peliss√§ hahmojen piirt√§miseen n√§yt√∂lle.
Yleens√§ funktion sis√§ll√§ tehd√§√§n ainakin kaksi asiaa:
tyhjennet√§√§n ruutu vanhoista asioista ja piirret√§√§n uudet asiat.</p>

<p>Alla on esimerkki silmukasta, jolla voimme piirt√§√§ hahmon n√§yt√∂lle neli√∂n√§.</p>

<script>codeExample(
`function piirr√§() {
	// Tyhjennet√§√§n ruutu
	piirt√§j√§.clearRect(0, 0, kangas.width, kangas.height)
	
	// Piirret√§√§n hahmo
	piirt√§j√§.fillStyle = hahmo.v√§ri
	piirt√§j√§.fillRect(hahmo.X, hahmo.Y, 10, 10)
	
	// Pyydet√§√§n selainta piirt√§m√§√§n samat asiat kohta uudestaan
	requestAnimationFrame(piirr√§)
}

// Pyydet√§√§n selainta piirt√§m√§√§n asiat ensimm√§isen kerran
requestAnimationFrame(piirr√§) `,"javascript");</script>

<p>Pohjimmiltaan piirtosilmukka on nimetty funktio.
K√§yt√§mme <code>requestAnimationFrame</code>-komentoa kertoaksemme selaimelle,
ett√§ haluamme k√§ytt√§√§ <code>piirr√§</code>-funktiota piirt√§√§ksemme asioita n√§yt√∂lle.
Selain suorittaa funktion silloin, kun on sen mielest√§ sopiva hetki.
Komento on koodissa kahdesti.
Se suoritetaan ensimm√§isen kerran viimeisell√§ rivill√§ heti funktion luomisen j√§lkeen.
(Itse funktion koodia ei suoriteta ennen kuin selain niin p√§√§tt√§√§.)
Lis√§ksi se suoritetaan aina funktion suorittamisen j√§lkeen.
N√§in funktiota suoritetaan ikuisesti: aina suorittamisen j√§lkeen pyyd√§mme selainta suorittamaan sen uudestaan.</p>

<h3 id="p√§ivityssilmukka">P√§ivityssilmukka</h3>

<p>P√§ivityssilmukka on funktio, jossa p√§ivit√§mme ohjelman muistissa olevia asioita, kuten hahmojen sijainteja ja pistem√§√§r√§√§.</p>

<p>Piirtosilmukka suoritetaan siis silloin, kun selain itse haluaa.
Selain p√§√§tt√§√§ niin sanotun FPS:n (kuinka monta kertaa n√§ytt√∂ p√§ivitet√§√§n sekunnissa) itse.
P√§ivityssilmukka taas suoritetaan yleens√§ tietyin v√§liajoin, jotta asiat tapahtuvat peliss√§ jatkuvasti yht√§ nopeasti.
K√§yt√§mme t√§h√§n jo aiemmin mainittua <code>setInterval</code>-komentoa.</p>

<p>Alla on esimerkki p√§ivityssilmukasta, joka siirt√§√§ hahmoa eteenp√§in kasvattamalla X-koordinaattia.
Silmukka suoritetaan 0,1 sekunnin v√§lein.</p>

<script>codeExample(
`setInterval(() => {
	hahmo.X += 1
}, 100) `,"javascript");</script>

<p>
Esimerkit yhdistettyn√§:

<div class="codebox example">
	<h3>Esimerkki 5.9</h3>
	<p>
	Liikkuva hahmo.
	</p>
	<script>
		addEditor(
`<!doctype HTML>
<canvas
	id = kangas
	style = background-color:beige;></canvas>
<script>
	const hahmo = {
		X: 20,
		Y: 10,
		v√§ri: "green",
	}

	const piirt√§j√§ = kangas.getContext("2d")

	function piirr√§() {
		// Tyhjennet√§√§n ruutu
		piirt√§j√§.clearRect(0, 0, kangas.width, kangas.height)
		
		// Piirret√§√§n hahmo
		piirt√§j√§.fillStyle = hahmo.v√§ri
		piirt√§j√§.fillRect(hahmo.X, hahmo.Y, 10, 10)
		
		// Pyydet√§√§n selainta piirt√§m√§√§n samat asiat kohta uudestaan
		requestAnimationFrame(piirr√§)
	}

	// Pyydet√§√§n selainta piirt√§m√§√§n asiat ensimm√§isen kerran
	requestAnimationFrame(piirr√§)

	setInterval(() => {
		hahmo.X += 1
	}, 100)
${closeScript}`
		);
	</script>
</div>

TODO: Teht√§v√§: Laatikon liikuttaminen nuolin√§pp√§imill√§

TODO: Teht√§v√§/projekti: Kilpa-ajo, jossa yksi laatikko liikkuu kun nappia painetaan ja toinen liikkuu hitaasti itsest√§√§n. Kumpi p√§√§see toiseen reunaan ensin?
</p>
:ET